<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Bridge 下载</title>
	<style>
		* {
			box-sizing: border-box;
			margin: 0;
			padding: 0;
		}

		body {
			font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
			display: flex;
			align-items: center;
			justify-content: center;
			min-height: 100vh;
			padding: 24px;
			background: #F0F2F5;
		}

		.card {
			width: 100%;
			max-width: 400px;
			padding: 32px 24px 24px;
			border-radius: 12px;
			background: #FFF;
			box-shadow: 0 2px 12px rgba(0, 0, 0, .08);
		}

		h1 {
			font-size: 1.6rem;
			font-weight: 700;
			margin-bottom: 6px;
		}

		.version-info {
			font-size: 0.85rem;
			color: #888;
		}

		.version-info span {
			margin-right: 12px;
		}

		#buttons {
			display: flex;
			flex-direction: column;
			margin-top: 34px;
			gap: 18px;
		}

		.btn {
			font-size: 0.95rem;
			font-weight: 500;
			display: block;
			width: 100%;
			padding: 13px;
			cursor: pointer;
			text-align: center;
			text-decoration: none;
			color: #FFF;
			border: none;
			border-radius: 8px;
		}

		.btn-cache {
			background: #1976D2;
		}

		.btn-github {
			background: #2E7D32;
		}

		.status {
			font-size: 0.9rem;
			color: #999;
		}

		.status.error {
			color: #C62828;
		}

		#sha256 {
			font-size: 0.75rem;
			margin-top: 18px;
			word-break: break-all;
			color: #AAA;
		}
	</style>
</head>
<body>
	<div class="card">
		<h1>Bridge</h1>
		<div class="version-info" id="version-info">
			<span class="status" id="status-text">正在获取版本信息…</span>
		</div>
		<div id="buttons" style="display: none;">
			<a id="btn-cache" class="btn btn-cache">本地下载</a>
			<a id="btn-github" class="btn btn-github" target="_blank" rel="noopener">GitHub 下载</a>
		</div>
		<div id="sha256"></div>
	</div>
	<script>
		const base = window.location.pathname.replace(/[^/]*$/, '');
		fetch(base + 'version')
		.then(r => r.json())
		.then(res => {
			if (!res.state) {
				document.getElementById('status-text').textContent = '版本信息不可用：' + res.message;
				document.getElementById('status-text').className = 'status error';
				return;
			}

			const {versionName, versionCode, downUrl, sha256} = res.data;

			const versionInfo = document.getElementById('version-info');
			versionInfo.innerHTML =
				'<span>版本 ' + versionName + ' (' + versionCode + ')</span>';

			const btnCache = document.getElementById('btn-cache');
			const btnGithub = document.getElementById('btn-github');

			if (downUrl.local) {
				btnCache.href = base + 'download';
			} else {
				btnCache.removeAttribute('href');
				btnCache.classList.add('btn-disabled');
			}

			btnGithub.href = downUrl.github;

			if (sha256) {
				document.getElementById('sha256').textContent = 'SHA-256: ' + sha256;
			}

			document.getElementById('buttons').style.display = '';
		})
		.catch(() => {
			document.getElementById('status-text').textContent = '无法连接到服务器';
			document.getElementById('status-text').className = 'status error';
		});
	</script>
</body>
</html>
